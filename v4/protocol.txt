1 Gate
  1.1 Request
    { type: "GATE.REQUEST", username: string } // string: non-empty
  1.2 Response
    { type: "GATE.RESPONSE", result: "Accepted" | "Pending review" | "IP is banned" | "Room is full" | "Duplicate usernames" | "Username consists of banned words" }
  1.3 Review Result
    { type: "GATE.REVIEW_RESULT", accepted: boolean }
  1.4 Enter Confirmation
    { type: "GATE.ENTER_CONFIRMATION", uid: number, accepted: boolean }
  1.5 Kick Request
    { type: "GATE.KICK_REQUEST", uid: number } // number: positive integer
  1.6 Incorrect Protocol
    { type: "GATE.INCORRECT_PROTOCOL", time: time, ip: ip } // time: rounded to millisecond, ip: IPv4 with port ID
  1.7 Client Request
    1.7.1 Announce
      { type: "GATE.CLIENT_REQUEST.ANNOUNCE", username: string, uid: number, result: "Accepted" | "Pending review" | "IP is banned" | "Room is full" | "Duplicate usernames" | "Username consists of banned words" }
    1.7.2 Log
      { type: "GATE.CLIENT_REQUEST.LOG", time: time, ip: ip, username: string, uid: number }
  1.8 Status Change Hint
    1.8.1 Announce
      { type: "GATE.STATUS_CHANGE_HINT.ANNOUNCE", status: "Rejected" | "Kicked" | "Offline" | "Pending" | "Online" | "Admin" | "Root", uid: number }
    1.8.2 Log
      { type: "GATE.STATUS_CHANGE_HINT.LOG", time: time, status: "Rejected" | "Kicked" | "Offline" | "Pending" | "Online" | "Admin" | "Root", uid: number, operator: number | 0 | -1 } // 0: root, -1: system


2 Chat
  2.1 Send
    { type: "CHAT.SEND", content: string, to: number | 0 | -1 } // to = -1 for broadcasting, to = 0 for public messages, to = UID for private messages for specific users
  2.2 Receive
    { type: "CHAT.RECEIVE", sender: number, content: string, broadcast: boolean, private: boolean }
  2.3 Sending Result
    { type: "CHAT.SENDING_RESULT", sending_result: "Success" | "Too long" | "Consists of banned words" | "Receiver is offline" | "Receiver cannot be the same as sender" | "Private messages forbidden" | "Only admins can broadcast" }
  2.4 Log
    { type: "CHAT.LOG", time: time, uid: number, content: string, to: number | 0 | -1, sending_result: "Success" | "Too long" | "Consists of banned words" | "Receiver is offline" | "Receiver cannot be the same as sender" | "Private messages forbidden" | "Only admins can broadcast" }


3 File Transfer
  3.1 Request
    { type: "FILE_TRANSFER.REQUEST", order: number, filename: string, size: number, to: number | 0 } // order: count for each user, start from 1
  3.2 Response
    { type: "FILE_TRANSFER.RESPONSE", response: "Approved" | "Too large" | "Server is busy" | "Filename consists of banned words" | "Receiver is offline" | "File transfer forbidden" | "Private file transfer forbidden" }
  3.3 Announce
    { type: "FILE_TRANSFER.ANNOUNCE", uid: number, order: number, filename: string, size: number, private: boolean }
  3.4 New Sockets
    3.4.1 Request
      { type: "FILE_TRANSFER.NEW_SOCKETS.REQUEST", uid: number, order: number }
    3.4.2 Response
      { type: "FILE_TRANSFER.NEW_SOCKETS.RESPONSE", response: "OK" | "User not found" | "IP mismatched" | "File not found" | "File is not for you" }
  3.5 Transferring
    3.5.1 Start
      { type: "FILE_TRANSFER.TRANSFERRING.START" }
    3.5.2 Processing
      { type: "FILE_TRANSFER.TRANSFERRING.PROCESSING", data: base64 }
    3.5.3 Finish
      { type: "FILE_TRANSFER.TRANSFERRING.FINISH", expected_data_length: number | 0 } // 0: failed
    3.5.4 Confirm Received
      { type: "FILE_TRANSFER.TRANSFERRING.CONFIRM_RECEIVED" }
  3.6 Log
    3.6.1 Request
      { type: "FILE_TRANSFER.LOG.REQUEST", time: time, uid: number, order: number, filename: string, size: number, to: number | 0, response: "Approved" | "Too large" | "Server is busy" | "Filename consists of banned words" | "Receiver is offline" | "File transfer forbidden" | "Private file transfer forbidden" }
    3.6.2 New Sockets
      { type: "FILE_TRANSFER.LOG.NEW_SOCKETS", time: time, ip: ip, uid: number, order: number, response: "OK" | "User not found" | "IP mismatched" | "File not found" | "File is not for you" }
    3.6.3 Transferring
      3.6.3.1 Start
        { type: "FILE_TRANSFER.LOG.TRANSFERRING.START", time: time, uid: number, order: number, new_sockets: { stringify(number): ip, ... } } // stringify(UID): new socket
      3.6.3.2 Processing
        { type: "FILE_TRANSFER.LOG.TRANSFERRING.PROCESSING", time: time, uid: number, order: number, data: base64 }
      3.6.3.3 Finish
        { type: "FILE_TRANSFER.LOG.TRANSFERRING.FINISH", time: time, uid: number, order: number, expected_data_length: number | 0, received: [number, ...], not_received: [number, ...] } // expected_data_length = 0 for sender issues (all failed); UID in lists


4 Server
  4.1 Start
    { type: "SERVER.START", time: time, server_version: string, config: JSON }
  4.2 Stop
    { type: "SERVER.STOP", time: time }
  4.3 Data
    { type: "SERVER.DATA", server_version: string, uid: number, config: JSON, users: [JSON, ...], chat_history: [JSON, ...] } // users: { username: string, status: "Rejected" | "Kicked" | "Offline" | "Pending" | "Online" | "Admin" | "Root" }, chat_history: { time: time, uid: number, content: string }, public messages only
  4.4 Config
    4.4.1 Post
      { type: "SERVER.CONFIG.POST", key: string, value: any }
    4.4.2 Change
      { type: "SERVER.CONFIG.CHANGE", key: string, value: any }
    4.4.3 Save
      { type: "SERVER.CONFIG.SAVE", time: time }
    4.4.4 Log
      { type: "SERVER.CONFIG.LOG", time: time, operator: number | 0, key: string, value: any }
